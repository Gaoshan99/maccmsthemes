window.FrontJS=function(e,r,t){"use strict";var n="https://collecter.frontjs.com/",o="https://static.frontjs.com/dist/current/tracker.min.js",a="0.1.2",i=1,s=2,c=4,u=8,l=256,m=512,d=513,f=514,g=768,p=769,v=770,_=771,h=772,D=1024,k=function(e,r){r=r||"";var t={1001:"Invalid token",1002:"Invalid behaviour settings",1003:"Invalid origin settings",1004:"Invalid exclude settings",1005:"Invalid user data",4000:"Bad configuration! Fail to start!",4001:"FrontJS is already defined, Fail to start!"};t[e]&&console.warn(["Error(frontjs):",t[e],"(CODE"+e+")","See https://www.frontjs.com/doc/view/errcode/#"+encodeURIComponent(r)].join(" "))};if(e.FrontJS)return k(4001),e.FrontJS;var S=function(e){return e&&e.match(/^\w{32}$/)?0:1},y=function(e){return e<=(i|s|c|u)?0:1},E=function(e){e=e||[];for(var r=0;r<e.length;r++)if("string"==typeof e[r]);else if(!e[r].test)return e[r];return 0},C=function(e){for(var r in e=e||{})if("object"==typeof e[r])return r;return 0},w={KVArrayCopy:function(e){var r={};for(var t in e)r[t]=e[t];return r},uriArrayCopy:function(e){e=e||[];for(var r=[],t=0;t<e.length;t++)"string"==typeof e[t]?r.push(e[t]):r.push(new RegExp(e[t].source,e[t].flag));return r},getTime:function(){return(new Date).getTime()},getGUID:function(){var e=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"],r=w.getTime().toString(16);for(r="0"+r;r.length<16;)r="f"+r;for(;r.length<32;)r+=e[Math.floor(16*Math.random())];return r},addSlashes:function(e){return e.replace(/(\.|\\|\/|\||\+|\$|\^)/g,"\\$1")},filterTrace:function(e){var r=new RegExp("((?!\n).)*"+w.addSlashes(o)+".*\n","g");return e.replace(r,"")},getUserAgent:function(){return e.navigator.userAgent},getCurrentURL:function(){return e.location.href},getRefererURL:function(){return r.referrer},getViewPortSize:function(){return{w:e.innerWidth,h:e.innerHeight,r:e.devicePixelRatio}},getClientID:function(){return e.localStorage?(e.localStorage.getItem("frontjs:client:id")||e.localStorage.setItem("frontjs:client:id",w.getGUID()),e.localStorage.getItem("frontjs:client:id")):w.getGUID()},getSessionID:function(){return e.sessionStorage?(e.sessionStorage.getItem("frontjs:session:id")||e.sessionStorage.setItem("frontjs:session:id",w.getGUID()),e.sessionStorage.getItem("frontjs:session:id")):w.getGUID()},checkCrossOrigin:function(e,r){if(r){e=e||"";for(var t=!1,n=0;n<r.length;n++)e.match(r[n])&&(t|=!0);return!t}return!1},checkTimingSlow:function(e,r){return!!r&&(e.send>r.sned&&r.sned>0||e.load>r.load&&r.load>0||e.total>r.total&&r.total>0)},calculateTrackerTiming:function(e){if(e._time_done&&e._time_load&&e._time_send&&e._time_done){var r=e._time_send-e._time_open,t=e._time_load-e._time_send,n=e._time_done-e._time_open;return{send:r=r<0?null:r,load:t=t<0?null:t,total:n=n<0?null:n}}return{send:0,load:0,total:0}},composeTrackerData:function(e,r){return{type:e,data:r}},composeScriptErrorData:function(e,r,t,n,o,a){return a=a&&a.stack?a.stack.toString():"",{message:e,detail:{err:r,file:t,line:n,column:o,trace:a=w.filterTrace(a)}}},composeXHRErrorData:function(e,r,t,n){return{message:e,detail:{requestURL:r,responseData:t,timing:n}}},composeResourceErrorData:function(e,r,t){return{message:e,detail:{tagname:r,resourceURL:t}}},composePerformaceData:function(e,r){return{message:e,detail:r}}},I=function(r){var t={},a=!0;if(S(r.token)?(k(1001),a&=!1):t.token=r.token.toString(),y(r.behaviour)?(k(1002),a&=!1):(t.behaviour=parseInt(r.behaviour),t.behaviour||(t.behaviour=i|s|c|u)),E(r.origin)){var l=E(r.behaviour);k(1003,l),a&=!1}else t.origin=w.uriArrayCopy(r.origin),t.origin.push(e.location.origin),t.origin.push(/^((?!:\/\/).)*$/),t.origin.push(o),t.origin.push(n);return E(r.exclude)?(l=E(r.exclude),k(1004,l),a&=!1):(t.exclude=w.uriArrayCopy(r.exclude),t.exclude.push(o),t.exclude.push(n)),C(r.userData)?(l=C(r.userData),k(1005,l),a&=!1):t.userData=w.KVArrayCopy(r.userData),!!a&&t}(t);if(!I)return k(4e3),!1;var R=e.XMLHttpRequest;if(e.XMLHttpRequest=function(){var e=new R;return e._tracker_open=e.open,e.tracker={_time_init:0,_time_open:0,_time_send:0,_time_load:0,_time_done:0,_request_method:"",_request_url:"",_status:""},e.addEventListener("error",j),e.addEventListener("timeout",j),e.addEventListener("readystatechange",j),e.open=function(r,t,n,o,a){return e.tracker._request_method=r,e.tracker._request_url=t,e.tracker._time_open=w.getTime(),e._tracker_open(r,t,n,o,a)},e},e.console){var L=e.console.log,U=e.console.warn,b=e.console.error;e.console.log=function(){var r=[].slice.call(arguments);if(!r.length)return!0;var t=w.composeScriptErrorData(257,r.join(", ").substr(0,1e3),"via console.log",0,0,new Error(r.join(", ").substr(0,1e3)));I.behaviour&i&&A(l,t),L.apply(e.console,r)},e.console.warn=function(){var r=[].slice.call(arguments);if(!r.length)return!0;var t=w.composeScriptErrorData(258,r.join(", ").substr(0,1e3),"via console.warn",0,0,new Error(r.join(", ").substr(0,1e3)));I.behaviour&i&&A(l,t),U.apply(e.console,r)},e.console.error=function(){var r=[].slice.call(arguments);if(!r.length)return!0;var t=w.composeScriptErrorData(259,r.join(", ").substr(0,1e3),"via console.error",0,0,new Error(r.join(", ").substr(0,1e3)));I.behaviour&i&&A(l,t),b.apply(e.console,r)}}function q(e){if(!e.message)return!0;var r=w.composeScriptErrorData(l,e.message,e.filename,e.lineno,e.colno,e.error);w.checkCrossOrigin(e.filename,I.exclude)&&I.behaviour&i&&A(l,r)}function T(e){var r=e.target.tagName,t=e.target.src||e.target.href;if(!(w.checkCrossOrigin(t,I.exclude)&&I.behaviour&s&&t))return!0;if("load"===e.type){if(w.checkCrossOrigin(t,I.origin)){var n=w.composeResourceErrorData(f,r,t);A(m,n)}}else"error"===e.type&&(n=w.composeResourceErrorData(d,r,t),A(m,n))}function j(e){var r=e.target;if(!(w.checkCrossOrigin(r.tracker._request_url,I.exclude)&&I.behaviour&c))return!0;if("readystatechange"===e.type){var t=["_time_init","_time_open","_time_send","_time_load","_time_done"];if(t[r.readyState]&&(r.tracker[t[r.readyState]]=w.getTime()),4===r.readyState){r.tracker._status=r.status;var n=w.calculateTrackerTiming(r.tracker);if(w.checkCrossOrigin(r.tracker._request_url,I.origin)){var o=w.composeXHRErrorData(h,r.tracker._request_url,{status:r.tracker._status},n);A(g,o)}(n.send||n.load||n.total||r.tracker._status)&&(o=w.composeXHRErrorData(_,r.tracker._request_url,{status:r.tracker._status},n),A(g,o))}}else"error"===e.type?(r.tracker._status=r.status,o=w.composeXHRErrorData(p,r.tracker._request_url,{status:r.tracker._status},n),A(g,o)):"timeout"===e.type&&(r.tracker._status=r.status,o=w.composeXHRErrorData(v,r.tracker._request_url,{status:r.tracker._status},n),A(g,o))}var x=w.getGUID();function A(r,t){var o=w.composeTrackerData(r,t);o.currentURL=w.getCurrentURL(),o.refererURL=w.getRefererURL(),o.viewPort=w.getViewPortSize(),o.userAgent=w.getUserAgent(),o.clientID=w.getClientID(),o.sessionID=w.getSessionID(),o.messageID=r===D?x:w.getGUID(),o.token=I.token,o.version=a,o.userData=I.userData,setTimeout(function(){var r,t,a;r=o,t=JSON.stringify(r),(a=new e.XMLHttpRequest).open("POST",n,!0),a.send(t)},0)}e.addEventListener("beforeunload",function(r){if(e.performance&&e.performance.timing&&I.behaviour&u){var t={};t.dns=e.performance.timing.domainLookupEnd-e.performance.timing.domainLookupStart,t.connect=e.performance.timing.connectEnd-e.performance.timing.connectStart,t.request=e.performance.timing.responseStart-e.performance.timing.requestStart,t.response=e.performance.timing.responseEnd-e.performance.timing.responseStart,t.dom=e.performance.timing.domInteractive-e.performance.timing.domLoading,t.domContent=e.performance.timing.domComplete-e.performance.timing.domInteractive,t.load=e.performance.timing.domComplete-e.performance.timing.domainLookupStart,t.view=(new Date).getTime()-e.performance.timing.domComplete,t.dns=t.dns<0?null:t.dns,t.connect=t.connect<0?null:t.connect,t.request=t.request<0?null:t.request,t.response=t.response<0?null:t.response,t.dom=t.dom<0?null:t.dom,t.domContent=t.domContent<0?null:t.domContent,t.load=t.load<0?null:t.load,t.view=t.view<0?null:t.view;var n=w.composePerformaceData(D,t);A(D,n)}},!0),e.addEventListener("load",function(r){if(e.performance&&e.performance.timing&&I.behaviour&u){var t={};t.dns=e.performance.timing.domainLookupEnd-e.performance.timing.domainLookupStart,t.connect=e.performance.timing.connectEnd-e.performance.timing.connectStart,t.request=e.performance.timing.responseStart-e.performance.timing.requestStart,t.response=e.performance.timing.responseEnd-e.performance.timing.responseStart,t.dom=e.performance.timing.domInteractive-e.performance.timing.domLoading,t.domContent=e.performance.timing.domComplete-e.performance.timing.domInteractive,t.load=e.performance.timing.domComplete-e.performance.timing.domainLookupStart,t.dns=t.dns<0?null:t.dns,t.connect=t.connect<0?null:t.connect,t.request=t.request<0?null:t.request,t.response=t.response<0?null:t.response,t.dom=t.dom<0?null:t.dom,t.domContent=t.domContent<0?null:t.domContent,t.load=t.load<0?null:t.load;var n=w.composePerformaceData(D,t);A(D,n)}},!0),e.addEventListener("error",q,!0),r.addEventListener("error",T,!0),r.addEventListener("load",T,!0);var O=function(e){function r(e){return e.message||(e=new Error(e)),e.error=e,e.filename=e.filename?e.filename:"",e.filename+=" via frontJS try - catch API",e.lineno=e.lineno?e.lineno:0,e.colno=e.colno?e.colno:0,q(e),null}return{try:function(){var e=arguments[0],t=arguments[1];try{return e.apply(t,[].slice.call(arguments,2))}catch(e){return r(e)}},catch:r,composedTry:function(e,t){return function(){try{return e.apply(t,[].slice.call(arguments))}catch(e){return r(e)}}},addUserData:function(r,t){return e.userData[r]=t,!0},removeUserData:function(r){return delete e.userData[r],!0}}}(I);return{C:{SCRIPT:i,RESOURCE:s,XHR:c,PERFOMACE:u},V:a,try:O.try,catch:O.catch,composedTry:O.composedTry,addUserData:O.addUserData,removeUserData:O.removeUserData}}(window,document,window.frontjsConfig);
//# sourceMappingURL=tracker.min.js.map